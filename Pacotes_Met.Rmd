---
title: "Pacotes_Meteorologicos"
author: "Camila"
date: '2022-08-19'
output: html_document
---

## Sobre

Este documento possui a finalidade de servir como uma espécie de dicionário ou guia introdutório para alguns dos pacotes disponíveis no R voltados para processamento de dados meteorológicos.

### Instalação e importação dos pacotes

1.  Instalação

```{r INSTALANDO PACOTES}
install.packages("rNOMADS")
install.packages("rdwd")
install.packages("weathercan")
install.packages("darksky")
install.packages("weatherData")
install.packages("RNCEP")
install.packages("rwunderground")
install.packages("riem")
install.packages("SkyWiseDataTransferR")
```

2.  Importação

```{r BAIXANDO BIBLIOTECAS}
library("rNOMADS")
library("rdwd")
library("darksky")
library("RNCEP")
library("rwunderground")
library("riem")
library("weathercan") # não instalou
library("weatherData") # não instalou
library("SkyWiseDataTransferR") # não instalou
```

### Pacote rNOMADS

#### Intro ao rNOMADS

O pacote `rNOMADS` é uma interface destinada ao download automático de dados de previsão do tempo do National Oceanic and Atmospheric Administration's Operational Model Archive and Distribution System (NOMADS) no R.

> O pacote permite fazer isso de 2 formas:
>
> > 1.  Lendo dados ascii diretamente do servidor usando o sistema DODS-GrAD
>
> > 2.  Fazendo o download de arquivos binários no formato GRIB1 ou GRIB2

> O recurso `grib` do `rNOMADS` usa uma série externa de rotinas chamadas `wgrib2` para ler os dados do modelo operacional. Obtenha `wgrib2` em: <http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/>.

> O pacote também tentará chamar outra rotina externa chamada `wgrib` se o usuário desejar ler arquivos GRIB1. Obtenha `wgrib` em <http://www.cpc.ncep.noaa.gov/products/wesley/wgrib.html>.

```{r rNOMADS}
help("rNOMADS")
ls("package:rNOMADS")
```

#### Funções do rNOMADS

O `rNOMADS` possui um total de 22 funções, porém as principais são: `GetDODSDates`, `GetDODSModelRuns`, `DODSGrabs`.

1.  `GetDODSDates` verifica o servidor de dados do GrADS para ver quais datas e subconjuntos de modelos estão disponíveis para o modelo especificado pelo argumento `abbrev`.

A estrutura do `GetDODSDates`é a seguinte: `GetDODSDates(abbrev, request.sleep=1)`.

> O argumento `abbrev` é um modelo de abreviação especificado pelo `NOMADSRealTimeList` ou pelo `NOMADSArchiveList`.
>
> > O `NOMADSArchiveList` gera uma lista de ebreviações, nomes e URLs para os modelos NOMADS arquivados no website NCDC.
> >
> > O `NOMADSRealTimeList` escaneia o website NOMADS Real Time para gerar uma lista dos produtos modelo disponíveis.
> >
> > > A estrutura de `NOMADSRealTimeList` é: `NOMADSRealTimeList(url.type, abbrev = NULL)`.
> > >
> > > > O argumento `url.type` determina se deve retornar um URL para extrair arquivos `grib` ou para obter dados de formato ascii diretamente do servidor `dods`.

[OBS.: Está dando erro.]{style="color:red"}

```{r Funções rNOMADS}
NOMADSArchiveList()
NOMADSRealTimeList("dods")

GetDODSDates("gfs_0p25")  # message error: The specified URL does not exist!  Make sure your model information is correct.  It is also possible the NOMADS server is down.
                          # Details:  Attempted to access https://nomads.ncep.noaa.gov:443/dods/gfs_0p50/ but did not succeed...

GetDODSModelRuns()

```

### Pacote rdwd

#### Intro ao rdwd

O pacote `rdwd` foi criado com o intuito de manusear dados climáticos do Serviço Meteorológico Alemão (DWD - German Weather Service).

O pacote nos permite: encontrar, selecionar, baixar e ler dados do DWD. Esses dados compreendem séries temporais observacionais de 6.000 registros de estações meteorológicas (com 2.500 ativas) com informações de: chuva, temperatura, vento, incidência solar, pressão, nebulosidade, umidade, neve, etc.

```{r rdwd, documentação: https://bookdown.org/brry/rdwd/}
help("rdwd")
ls("package:rdwd")

# selecionando um dataset
link <- selectDWD("Potsdam", res="daily", var="kl", per="recent")

# baixando o dataset em um arquivo zip
file <- dataDWD(link, read=FALSE)

# lendo o arquivo zip baixado | dá erro: system command 'unzip' could not be found
clim <- readDWD(file, varnames=TRUE)

# extraí o arquivo manualmente e agora vou importar
clim <- read.csv2("DWDdata/daily_kl_recent_tageswerte_KL_03987_akt/Metadaten_Geraete_Luftdruck_Stationshoehe_03987.txt")

# examinando o arquivo
str(clim)
View(clim)

# renomeando as colunas para português
# c("ID_estac", "Nome_estac", "Long", "Lat", "altura_estac", "altura_barometrica", "data_de", "data_ate", "tipo_dispositivo", "metodo_medicao", "ou", "x")
```

```{")}
```

### Pacote darksky

```{r darksky, documentacao: https://github.com/hrbrmstr/darksky}
# requere tidyverse
install.packages("tidyverse")
library("tidyverse")

help("darksky")
ls("darksky") # a lista de comandos não funciona com esse pacote

now <- get_current_forecast(43.2672, -70.8617) # pede para inserir API key
darksky_api_key() # precisa criar um arquivo .Renviron
```

### Pacote RNCEP

```{r RNCEP, documentacao: https://github.com/cran/RNCEP}
help("RNCEP")
ls("package:RNCEP")

# Função NCEP.gather() -nesse caso pegamos a temperatura numa pressão específica
airtemp_press <- NCEP.gather(variable = "air", level=850,
    months.minmax=c(9,10), years.minmax=c(1996,1997),
    lat.southnorth=c(50,55), lon.westeast=c(5,10),
    reanalysis2 = FALSE, return.units = TRUE)

View(airtemp_press)  # visualizando o dado importado
mode(airtemp_press)   # entendendo o dado importado (numeric)
class(airtemp_press)  # entendendo o dado importado (array)
```

### Pacote rwunderground

```{r rwunderground, documentacao: https://github.com/ALShum/rwunderground}
help("rwunderground") # não encontra nenhum item
ls("rwunderground")   # não encontra nenhum item


```

### Pacote riem

```{r riem, documentacao: https://github.com/ropensci/riem}
help("riem")
ls("riem")
```
